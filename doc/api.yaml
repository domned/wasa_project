---
openapi: 3.0.3
info:
    title: 'WASAText API'
    description: |-
        A modern chat application API that allows users to create groups,
        start conversations, send messages, react to messages, and manage
        contacts.

        Features include:
        - Real-time messaging with WebSocket support
        - Image messaging with automatic compression
        - Message reactions with toggle behavior (prevents duplicates)
        - Group chat management
        - Contact management
        - Message forwarding (including images)
        - User profiles with photos
    version: '1.2.0'

tags:
    - name: Authentication
      description: User authentication and session management
    - name: Users
      description: User profile management and operations
    - name: Conversations
      description: Group and conversation management
    - name: Messages
      description: Message sending, forwarding, and management
    - name: Reactions
      description: Message reactions and emoji management
    - name: Comments
      description: Message comments management
    - name: Contacts
      description: User contact management
    - name: WebSocket
      description: Real-time messaging WebSocket connection
    - name: Health
      description: Service health monitoring

security:
    - bearerAuth: []

# Note: All authenticated endpoints (those requiring bearerAuth) will return
# a 401 Unauthorized response if authentication fails. See the UnauthorizedError
# response definition in components for details.

components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: UUID
            description: |-
                Bearer token authentication using User UUID as the token.
                The token should be the UUID of an existing user in the system.

    schemas:
        User:
            type: object
            description: Represents a user in the chat application
            properties:
                id:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the user
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                username:
                    type: string
                    example: 'Alice'
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
                picture:
                    type: string
                    example: 'https://example.com/avatar.jpg'
                    description: URL to user's profile picture
                    pattern: '^https?://.*'
                    minLength: 10
                    maxLength: 2048
            required:
                - id
                - username

        Conversation:
            type: object
            description: Represents a conversation/group chat between multiple users
            properties:
                id:
                    type: string
                    example: 'c0c0c0c0-0000-0000-0000-000000000001'
                    description: UUID of the conversation
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                name:
                    type: string
                    example: 'Group Chat'
                    description: Name of the conversation (empty for 1:1 chats)
                    pattern: '^.*$'
                    minLength: 0
                    maxLength: 100
                picture:
                    type: string
                    example: 'https://example.com/group-avatar.jpg'
                    description: URL to conversation's picture
                    pattern: '^https?://.*'
                    minLength: 10
                    maxLength: 2048
                participants:
                    type: array
                    items:
                        $ref: '#/components/schemas/User'
                    description: List of users in the conversation
                    minItems: 1
                    maxItems: 100
            required:
                - id
                - participants

        Message:
            type: object
            description: Represents a message in a conversation with text, images, reactions, and metadata
            properties:
                id:
                    type: string
                    example: '85f9cc23-48d7-448d-9172-7d5fd9cd4858'
                    description: UUID of the message
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                senderId:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the message sender
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                text:
                    type: string
                    example: 'Hello, how are you?'
                    description: Content of the message
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 5000
                imageUrl:
                    type: string
                    example: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...'
                    description: Base64 encoded image data
                    pattern: '^data:image\/(jpeg|jpg|png|gif|webp);base64,[A-Za-z0-9+/]+={0,2}$'
                    minLength: 20
                    maxLength: 10485760
                senderUsername:
                    type: string
                    example: 'Alice'
                    description: Username of the message sender
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
                time:
                    type: string
                    format: date-time
                    example: '2025-01-01T12:00:00Z'
                    description: Timestamp when the message was sent
                    pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$'
                    minLength: 19
                    maxLength: 24
                reactions:
                    type: object
                    additionalProperties:
                        type: object
                        properties:
                            count:
                                type: integer
                                example: 3
                                minimum: 1
                                maximum: 10000
                                description: Number of users who reacted with this emoji
                            users:
                                type: array
                                items:
                                    type: string
                                    pattern: '^.*$'
                                    minLength: 3
                                    maxLength: 16
                                    description: Username of a user who reacted
                                example: ['Alice', 'Bob']
                                minItems: 1
                                maxItems: 50
                                description: List of usernames who reacted with this emoji
                    description: >-
                        Reactions to the message (emoji -> reaction data)
            required:
                - id
                - senderId
                - senderUsername
                - time

        Reaction:
            type: object
            description: Represents an emoji reaction to toggle on a message
            properties:
                emoji:
                    type: string
                    example: 'ðŸ‘'
                    description: The emoji reaction to toggle (add if not present, remove if already exists)
                    pattern: '^.{1,10}$'
                    minLength: 1
                    maxLength: 10
            required:
                - emoji

        Comment:
            type: object
            description: Represents a comment on a specific message
            properties:
                id:
                    type: string
                    example: 'comment-uuid'
                    description: UUID of the comment
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                messageId:
                    type: string
                    example: 'message-uuid'
                    description: UUID of the parent message
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                senderId:
                    type: string
                    example: 'user-uuid'
                    description: UUID of the comment sender
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                content:
                    type: string
                    example: 'Great point!'
                    description: Content of the comment
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 500
            required:
                - id
                - messageId
                - senderId
                - content

        Contact:
            type: object
            description: Represents a contact relationship between two users
            properties:
                id:
                    type: string
                    example: 'contact-uuid'
                    description: UUID of the contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                userId:
                    type: string
                    example: 'user-uuid'
                    description: UUID of the user who owns this contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                contactUserId:
                    type: string
                    example: 'contact-user-uuid'
                    description: UUID of the user being contacted
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                username:
                    type: string
                    example: 'Bob'
                    description: Username of the contact
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
            required:
                - id
                - userId
                - contactUserId
                - username

        LoginRequest:
            type: object
            description: Request payload for user login/registration
            properties:
                name:
                    type: string
                    example: 'Alice'
                    description: Username for login or registration
                    pattern: '^[a-zA-Z0-9_]+$'
                    minLength: 3
                    maxLength: 16
            required:
                - name

        LoginResponse:
            type: object
            description: Response payload containing user identifier after successful login
            properties:
                identifier:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the logged in user
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - identifier

        SendMessageRequest:
            type: object
            description: Request payload for sending a message (text and/or image)
            properties:
                content:
                    type: string
                    example: 'Hello everyone!'
                    description: Content of the message to send
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 5000
                imageUrl:
                    type: string
                    example: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...'
                    description: Base64 encoded image data with MIME type prefix (optional)
                    pattern: '^data:image\/(jpeg|jpg|png|gif|webp);base64,[A-Za-z0-9+/]+={0,2}$'
                    minLength: 20
                    maxLength: 10485760
            anyOf:
                - required: [content]
                - required: [imageUrl]

        CreateConversationRequest:
            type: object
            description: Request payload for creating a new conversation/group chat
            properties:
                participants:
                    type: array
                    items:
                        type: string
                        pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                        minLength: 36
                        maxLength: 36
                        description: UUID of a participant user
                    example: ['user-uuid-1', 'user-uuid-2']
                    description: >-
                        List of user UUIDs to include in the conversation
                    minItems: 1
                    maxItems: 100
                name:
                    type: string
                    example: 'Project Discussion'
                    description: >-
                        Name for the conversation (optional for 1:1 chats)
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 100
            required:
                - participants

        ForwardMessageRequest:
            type: object
            description: Request payload for forwarding a message to another conversation
            properties:
                content:
                    type: string
                    example: 'target-conversation-uuid'
                    description: UUID of the target conversation
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - content

        AddContactRequest:
            type: object
            description: Request payload for adding a new contact
            properties:
                contactUserId:
                    type: string
                    example: 'user-uuid'
                    description: UUID of the user to add as contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - contactUserId

        CommentRequest:
            type: object
            description: Request payload for adding a comment to a message
            properties:
                content:
                    type: string
                    example: 'Great message!'
                    description: Content of the comment
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 500
            required:
                - content

        UpdateUsernameRequest:
            type: object
            description: Request payload for updating a user's username
            properties:
                username:
                    type: string
                    minLength: 3
                    maxLength: 16
                    pattern: '^[a-zA-Z0-9_]+$'
                    example: 'Alice'
                    description: New username for the user
            required:
                - username

        Error:
            type: object
            description: Standard error response containing error message
            properties:
                message:
                    type: string
                    example: 'Invalid input provided'
                    description: Error message describing what went wrong
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 500
            required:
                - message

        AdminHealthResponse:
            type: object
            description: System health status response for administrative monitoring
            properties:
                database:
                    type: string
                    example: 'Healthy'
                    description: Database connection health status
                    pattern: '^(Healthy|Error|Unknown)$'
                    minLength: 5
                    maxLength: 10
                websocket:
                    type: string
                    example: 'Active'
                    description: WebSocket connection health status
                    pattern: '^(Active|Idle|Not initialized|Error)$'
                    minLength: 4
                    maxLength: 15
                api:
                    type: string
                    example: 'Running'
                    description: API service health status
                    pattern: '^(Running|Error|Stopped)$'
                    minLength: 5
                    maxLength: 8
                uptime:
                    type: string
                    example: '2 days, 14 hours, 32 minutes'
                    description: Server uptime in human-readable format
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 100
            required:
                - database
                - websocket
                - api
                - uptime

        AdminStatsResponse:
            type: object
            description: System statistics response for administrative monitoring
            properties:
                total_users:
                    type: integer
                    example: 150
                    description: Total number of users in the system
                    minimum: 0
                    maximum: 1000000
                active_users:
                    type: integer
                    example: 23
                    description: Number of users active in the last 24 hours
                    minimum: 0
                    maximum: 1000000
                total_conversations:
                    type: integer
                    example: 87
                    description: Total number of conversations in the system
                    minimum: 0
                    maximum: 1000000
                total_messages:
                    type: integer
                    example: 2341
                    description: Total number of messages sent in the system
                    minimum: 0
                    maximum: 10000000
                active_connections:
                    type: integer
                    example: 12
                    description: Number of active WebSocket connections
                    minimum: 0
                    maximum: 10000
                error_rate:
                    type: number
                    format: float
                    example: 0.01
                    description: Current system error rate (0.0 to 1.0)
                    minimum: 0.0
                    maximum: 1.0
            required:
                - total_users
                - active_users
                - total_conversations
                - total_messages
                - active_connections
                - error_rate

        LogEntry:
            type: object
            description: System log entry for administrative monitoring
            properties:
                id:
                    type: integer
                    example: 12345
                    description: Unique identifier for the log entry
                    minimum: 1
                level:
                    type: string
                    example: 'INFO'
                    description: Log level (DEBUG, INFO, WARN, ERROR, FATAL)
                    pattern: '^(DEBUG|INFO|WARN|ERROR|FATAL)$'
                    minLength: 4
                    maxLength: 5
                message:
                    type: string
                    example: 'User logged in successfully'
                    description: Log message content
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 1000
                timestamp:
                    type: string
                    format: date-time
                    example: '2025-01-15T14:30:00Z'
                    description: Timestamp when the log entry was created
            required:
                - id
                - level
                - message
                - timestamp

        AdminLogsResponse:
            type: object
            description: System logs response for administrative monitoring
            properties:
                logs:
                    type: array
                    items:
                        $ref: '#/components/schemas/LogEntry'
                    description: Array of recent system log entries
                    minItems: 0
                    maxItems: 100
            required:
                - logs

    responses:
        SuccessMessage:
            description: Operation completed successfully
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            message:
                                type: string
                                example: 'Operation completed successfully'
                                description: Success message indicating the operation was completed
                                pattern: '^.*$'
                                minLength: 1
                                maxLength: 200
                        required:
                            - message

        UnauthorizedError:
            description: Authentication information is missing or invalid
            content:
                application/json:
                    schema:
                        $ref: '#/components/schemas/Error'
                    examples:
                        missing_header:
                            summary: Missing Authorization header
                            value:
                                message: 'Authorization header required'
                        invalid_format:
                            summary: Invalid authorization format
                            value:
                                message: "Invalid authorization format. Use 'Bearer <token>'"
                        invalid_token:
                            summary: Invalid token format
                            value:
                                message: 'Invalid token format'
                        user_not_found:
                            summary: User not found
                            value:
                                message: 'Invalid token - user not found'

paths:
    /:
        get:
            tags: ['Health']
            summary: API root endpoint
            description: Returns basic API information and status
            operationId: getApiRoot
            responses:
                '200':
                    description: API information
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    name:
                                        type: string
                                        example: 'WASAText API'
                                    version:
                                        type: string
                                        example: '1.2.0'
                                    status:
                                        type: string
                                        example: 'running'
                                    endpoints:
                                        type: integer
                                        example: 26
                                        description: Number of available API endpoints

    /session:
        post:
            tags: ['Authentication']
            summary: User login
            description: |-
                If the user does not exist, it will be created and an
                identifier is returned.
                If the user exists, the user identifier is returned.
            operationId: doLogin
            requestBody:
                description: User login details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/LoginRequest'
                required: true
            responses:
                '201':
                    description: User login successful
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/LoginResponse'
                '400':
                    description: Invalid input - name must be 3-16 characters
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users:
        get:
            tags: ['Users']
            summary: List all users
            description: Returns a list of all users in the system
            operationId: listUsers
            responses:
                '200':
                    description: List of users
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/User'
                                minItems: 0
                                maxItems: 10000
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
        put:
            tags: ['Users']
            summary: Update username
            description: Set or update the user's username
            operationId: setMyUserName
            requestBody:
                description: New username for the user
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/UpdateUsernameRequest'
                required: true
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '400':
                    description: Invalid username format
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/photo:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
        put:
            tags: ['Users']
            summary: Update user photo
            description: Set or update the user's profile picture
            operationId: setMyPhoto
            requestBody:
                description: New photo URL as a JSON string
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'https://example.com/new-avatar.jpg'
                            description: URL of the new profile picture
                            pattern: '^https?://.*'
                            minLength: 10
                            maxLength: 2048
                required: true
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '400':
                    description: Invalid photo URL
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/context:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
        get:
            tags: ['Users']
            summary: Get user context
            description: Get context information for the user
            operationId: getContextReply
            responses:
                '200':
                    description: User context retrieved successfully
                    content:
                        application/json:
                            schema:
                                type: object
                                description: User context information
                                properties:
                                    context:
                                        type: string
                                        description: Context information for the user
                                        pattern: '^.*$'
                                        minLength: 0
                                        maxLength: 1000
                                        example: 'User is active and has recent messages'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
        get:
            tags: ['Conversations']
            summary: Get user conversations
            description: Returns all conversations for the specified user
            operationId: getMyConversations
            responses:
                '200':
                    description: List of user conversations
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Conversation'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Conversations']
            summary: Create conversation
            description: >-
                Create a new conversation with specified participants
            operationId: createConversation
            requestBody:
                description: Conversation creation details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateConversationRequest'
                required: true
            responses:
                '201':
                    description: Conversation created successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Conversation'
                '400':
                    description: Invalid request data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        get:
            tags: ['Conversations']
            summary: Get conversation details
            description: Get details of a specific conversation
            operationId: getConversation
            responses:
                '200':
                    description: Conversation details
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Conversation'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/members:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        post:
            tags: ['Conversations']
            summary: Add member to group
            description: Add a new member to an existing group conversation
            operationId: addtoGroup
            requestBody:
                description: User ID to add to the group
                content:
                    application/json:
                        schema:
                            type: object
                            description: Request to add a user to a group conversation
                            properties:
                                userId:
                                    type: string
                                    format: uuid
                                    description: UUID of the user to add to the group
                                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                                    minLength: 36
                                    maxLength: 36
                                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                            required:
                                - userId
                required: true
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '400':
                    description: Invalid request data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation or user not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        delete:
            tags: ['Conversations']
            summary: Leave group
            description: Remove the user from the group conversation
            operationId: leaveGroup
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/name:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        put:
            tags: ['Conversations']
            summary: Set group name
            description: Set or update the name of a group conversation
            operationId: setGroupName
            requestBody:
                description: New group name
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'Project Team'
                            description: New name for the group conversation
                            pattern: '^.*$'
                            minLength: 1
                            maxLength: 100
                required: true
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '400':
                    description: Invalid group name
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/photo:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        put:
            tags: ['Conversations']
            summary: Set group photo
            description: Set or update the photo of a group conversation
            operationId: setGroupPhoto
            requestBody:
                description: New group photo URL
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'https://example.com/group-photo.jpg'
                            description: URL of the new group photo
                            pattern: '^https?://.*'
                            minLength: 10
                            maxLength: 2048
                required: true
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '400':
                    description: Invalid photo URL
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        get:
            tags: ['Messages']
            summary: Get messages
            description: Get all messages from a conversation
            operationId: getMessages
            responses:
                '200':
                    description: List of messages
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Message'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Messages']
            summary: Send message
            description: Send a new text message or image to the conversation. Images should be provided as base64-encoded data URLs.
            operationId: sendMessage
            requestBody:
                description: Message content (text and/or image)
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/SendMessageRequest'
                required: true
            responses:
                '201':
                    description: Message sent successfully
                    content:
                        application/json:
                            schema:
                                type: string
                                description: UUID of the created message
                                format: uuid
                                pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                                minLength: 36
                                maxLength: 36
                '400':
                    description: Invalid message content
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
        delete:
            tags: ['Messages']
            summary: Delete message
            description: Delete a message (only by the sender)
            operationId: deleteMessage
            responses:
                '204':
                    description: Message deleted successfully (no content)
                '403':
                    description: Not authorized to delete this message
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/forward:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
        post:
            tags: ['Messages']
            summary: Forward message
            description: Forward a message (including images) to another conversation with a [Forwarded] prefix
            operationId: forwardMessage
            requestBody:
                description: Target conversation for forwarding
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/ForwardMessageRequest'
                required: true
            responses:
                '200':
                    description: Message forwarded successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Conversation'
                '400':
                    description: Invalid request data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message or target conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/reaction:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
        post:
            tags: ['Reactions']
            summary: Toggle reaction
            description: Toggle a reaction on a message. If the user has already reacted with this emoji, the reaction will be removed. If not, it will be added.
            operationId: reactToMessage
            requestBody:
                description: Emoji to toggle
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/Reaction'
                required: true
            responses:
                '201':
                    description: Reaction toggled successfully (no content)
                '400':
                    description: Invalid reaction data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/reaction/{emoji}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
            - name: emoji
              in: path
              description: The emoji reaction to remove
              required: true
              schema:
                  type: string
                  pattern: '^.{1,10}$'
                  minLength: 1
                  maxLength: 10
        delete:
            tags: ['Reactions']
            summary: Remove reaction
            description: Remove a specific reaction from a message
            operationId: removeReaction
            responses:
                '204':
                    description: Reaction removed successfully (no content)
                '404':
                    description: Message or reaction not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/comments:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
        post:
            tags: ['Comments']
            summary: Add comment
            description: Add a comment to a message
            operationId: commentMessage
            requestBody:
                description: Comment content
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CommentRequest'
                required: true
            responses:
                '201':
                    description: Comment added successfully
                    content:
                        application/json:
                            schema:
                                type: string
                                description: UUID of the created comment
                                format: uuid
                                pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                                minLength: 36
                                maxLength: 36
                '400':
                    description: Invalid comment data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/comments/{commentId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  format: uuid
            - name: commentId
              in: path
              description: UUID of the comment
              required: true
              schema:
                  type: string
                  format: uuid
        delete:
            tags: ['Comments']
            summary: Delete comment
            description: Delete a comment (only by the commenter)
            operationId: deleteComment
            responses:
                '204':
                    description: Comment deleted successfully (no content)
                '403':
                    description: Not authorized to delete this comment
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Comment not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/contacts:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
        get:
            tags: ['Contacts']
            summary: List contacts
            description: Get all contacts for the user
            operationId: listContacts
            responses:
                '200':
                    description: List of contacts
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Contact'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Contacts']
            summary: Add contact
            description: Add a new contact for the user
            operationId: addContact
            requestBody:
                description: Contact details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AddContactRequest'
                required: true
            responses:
                '201':
                    description: Contact added successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Contact'
                '400':
                    description: Invalid contact data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/contacts/{contactId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
            - name: contactId
              in: path
              description: UUID of the contact
              required: true
              schema:
                  type: string
                  format: uuid
        delete:
            tags: ['Contacts']
            summary: Remove contact
            description: Remove a contact from the user's contact list
            operationId: removeContact
            responses:
                '200':
                    $ref: '#/components/responses/SuccessMessage'
                '404':
                    description: Contact not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /conversations/all:
        get:
            tags: ['Conversations']
            summary: Get all conversations
            description: >-
                Returns all conversations in the database (for admin or
                user picker)
            operationId: getAllConversations
            responses:
                '200':
                    description: List of all conversations
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Conversation'
                                minItems: 0
                                maxItems: 10000
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /ws:
        get:
            tags: ['WebSocket']
            summary: WebSocket connection
            description: >-
                Establish a WebSocket connection for real-time communication
            operationId: serveWs
            responses:
                '101':
                    description: WebSocket connection established
                '400':
                    description: Bad request - cannot upgrade to WebSocket
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /liveness:
        get:
            tags: ['Health']
            summary: Health check
            description: Health check endpoint for monitoring server status
            operationId: liveness
            responses:
                '204':
                    description: Server is healthy

    /admin/health:
        get:
            tags: ['Health']
            summary: System health status
            description: Returns detailed system health information for administrative monitoring
            operationId: getAdminHealth
            security:
                - bearerAuth: []
            responses:
                '200':
                    description: System health status retrieved successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AdminHealthResponse'
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /admin/stats:
        get:
            tags: ['Health']
            summary: System statistics
            description: Returns detailed system statistics for administrative monitoring
            operationId: getAdminStats
            security:
                - bearerAuth: []
            responses:
                '200':
                    description: System statistics retrieved successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AdminStatsResponse'
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /admin/logs:
        get:
            tags: ['Health']
            summary: System logs
            description: Returns recent system log entries for administrative monitoring
            operationId: getAdminLogs
            security:
                - bearerAuth: []
            parameters:
                - name: limit
                  in: query
                  description: Maximum number of log entries to return
                  required: false
                  schema:
                      type: integer
                      minimum: 1
                      maximum: 100
                      default: 50
            responses:
                '200':
                    description: System logs retrieved successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AdminLogsResponse'
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /admin/online-users:
        get:
            tags: ['Users']
            summary: Online users
            description: Returns list of currently online user IDs based on active WebSocket connections
            operationId: getOnlineUsers
            security:
                - bearerAuth: []
            responses:
                '200':
                    description: Online users list retrieved successfully
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    type: string
                                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                                    minLength: 36
                                    maxLength: 36
                                    description: UUID of an online user
                                minItems: 0
                                maxItems: 1000
                                description: List of UUIDs of currently online users
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
