---
openapi: 3.0.3
info:
    title: 'WASAText API'
    description: |-
        A modern chat application API that allows users to create groups,
        start conversations, send messages, react to messages, and manage
        contacts.

        Features include:
        - Real-time messaging with WebSocket support
        - Image messaging with automatic compression
        - Emoji comments with toggle behavior (prevents duplicates)
        - Group chat management
        - Contact management
        - Message forwarding (including images)
        - User profiles with photos
    version: '1.2.0'

tags:
    - name: Authentication
      description: User authentication and session management
    - name: Users
      description: User profile management and operations
    - name: Conversations
      description: Group and conversation management
    - name: Messages
      description: Message sending, forwarding, and management
    - name: Comments
      description: Emoji comments (reaction-like) and their management
    - name: Contacts
      description: User contact management
    - name: WebSocket
      description: Real-time messaging WebSocket connection
    - name: Health
      description: Service health monitoring

security:
    - bearerAuth: []

# Note: All authenticated endpoints (those requiring bearerAuth) will return
# a 401 Unauthorized response if authentication fails. See the UnauthorizedError
# response definition in components for details.

components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: UUID
            description: |-
                Bearer token authentication using User UUID as the token.
                The token should be the UUID of an existing user in the system.

    schemas:
        User:
            type: object
            description: Represents a user in the chat application
            properties:
                id:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the user
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                username:
                    type: string
                    example: 'Alice'
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
                picture:
                    type: string
                    example: 'https://example.com/avatar.jpg'
                    description: URL to user's profile picture
                    pattern: '^https?://.*'
                    minLength: 10
                    maxLength: 2048
            required:
                - id
                - username

        Conversation:
            type: object
            description: Represents a conversation/group chat between multiple users
            properties:
                id:
                    type: string
                    example: 'c0c0c0c0-0000-0000-0000-000000000001'
                    description: UUID of the conversation
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                name:
                    type: string
                    example: 'Group Chat'
                    description: Name of the conversation (empty for 1:1 chats)
                    pattern: '^.*$'
                    minLength: 0
                    maxLength: 100
                picture:
                    type: string
                    example: 'https://example.com/group-avatar.jpg'
                    description: URL to conversation's picture
                    pattern: '^https?://.*'
                    minLength: 10
                    maxLength: 2048
                participants:
                    type: array
                    items:
                        $ref: '#/components/schemas/User'
                    description: List of users in the conversation
                    minItems: 1
                    maxItems: 100
                lastMessage:
                    $ref: '#/components/schemas/Message'
                lastMessageTime:
                    type: string
                    description: Unix time in milliseconds as a string
                    pattern: '^\d{1,13}$'
                    example: '1730000123456'
                    minLength: 1
                    maxLength: 13
                unreadCount:
                    type: integer
                    minimum: 0
                    example: 0
            required:
                - id
                - participants

        Message:
            type: object
            description: Represents a message in a conversation with text, images, emoji comments, and metadata
            properties:
                id:
                    type: string
                    example: '85f9cc23-48d7-448d-9172-7d5fd9cd4858'
                    description: UUID of the message
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                senderId:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the message sender
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                text:
                    type: string
                    example: 'Hello, how are you?'
                    description: Content of the message
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 5000
                imageUrl:
                    type: string
                    example: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...'
                    description: Base64 encoded image data
                    pattern: '^data:image\/(jpeg|jpg|png|gif|webp);base64,[A-Za-z0-9+/]+={0,2}$'
                    minLength: 20
                    maxLength: 10485760
                senderUsername:
                    type: string
                    example: 'Alice'
                    description: Username of the message sender
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
                time:
                    type: string
                    format: date-time
                    example: '2025-01-01T12:00:00Z'
                    description: Timestamp when the message was sent
                    pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$'
                    minLength: 19
                    maxLength: 24
                comments:
                    type: object
                    additionalProperties:
                        type: object
                        properties:
                            count:
                                type: integer
                                example: 3
                                minimum: 1
                                maximum: 10000
                                description: Number of users who commented with this emoji
                            users:
                                type: string
                                example: 'Alice,Bob'
                                description: Comma-separated list of usernames who commented with this emoji
                                minLength: 3
                                maxLength: 20
                    description: >-
                        Emoji comments on the message (emoji -> comment data)
                isRead:
                    type: boolean
                    description: Whether the message is considered read from the sender's perspective
            required:
                - id
                - senderId
                - senderUsername
                - time

        Comment:
            type: object
            description: Represents an emoji comment (emoji reaction) to toggle on a message
            properties:
                emoji:
                    type: string
                    example: 'ðŸ‘'
                    description: The emoji to toggle (add if not present, remove if already exists)
                    pattern: '^.{1,10}$'
                    minLength: 1
                    maxLength: 10
            required:
                - emoji

        Contact:
            type: object
            description: Represents a contact relationship between two users
            properties:
                id:
                    type: string
                    example: 'contact-uuid'
                    description: UUID of the contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                userId:
                    type: string
                    example: 'user-uuid'
                    description: UUID of the user who owns this contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                contactUserId:
                    type: string
                    example: 'contact-user-uuid'
                    description: UUID of the user being contacted
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
                username:
                    type: string
                    example: 'Bob'
                    description: Username of the contact
                    pattern: '^.*$'
                    minLength: 3
                    maxLength: 16
            required:
                - id
                - userId
                - contactUserId
                - username

        LoginRequest:
            type: object
            description: Request payload for user login/registration
            properties:
                name:
                    type: string
                    example: 'Alice'
                    description: Username for login or registration
                    pattern: '^[a-zA-Z0-9_]+$'
                    minLength: 3
                    maxLength: 16
            required:
                - name

        LoginResponse:
            type: object
            description: Response payload containing user identifier after successful login
            properties:
                identifier:
                    type: string
                    example: 'f2555a8a-2e66-4326-9588-20e7e298d615'
                    description: UUID of the logged in user
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - identifier

        SendMessageRequest:
            type: object
            description: Request payload for sending a message (text and/or image)
            properties:
                content:
                    type: string
                    example: 'Hello everyone!'
                    description: Content of the message to send
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 5000
                imageUrl:
                    type: string
                    example: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQ...'
                    description: Base64 encoded image data with MIME type prefix (optional)
                    pattern: '^data:image\/(jpeg|jpg|png|gif|webp);base64,[A-Za-z0-9+/]+={0,2}$'
                    minLength: 20
                    maxLength: 10485760
            anyOf:
                - required: [content]
                - required: [imageUrl]

        CreateConversationRequest:
            type: object
            description: Request payload for creating a new conversation/group chat
            properties:
                participants:
                    type: array
                    items:
                        type: string
                        pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                        minLength: 36
                        maxLength: 36
                        description: UUID of a participant user
                    example: ['user-uuid-1', 'user-uuid-2']
                    description: >-
                        List of user UUIDs to include in the conversation
                    minItems: 1
                    maxItems: 100
                name:
                    type: string
                    example: 'Project Discussion'
                    description: >-
                        Name for the conversation (optional for 1:1 chats)
                    pattern: '^.*$'
                    minLength: 0
                    maxLength: 100
            required:
                - participants

        ForwardMessageRequest:
            type: object
            description: Request payload for forwarding a message to another conversation
            properties:
                content:
                    type: string
                    example: 'target-conversation-uuid'
                    description: UUID of the target conversation
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - content

        AddContactRequest:
            type: object
            description: Request payload for adding a new contact
            properties:
                contactUserId:
                    type: string
                    example: 'user-uuid'
                    description: UUID of the user to add as contact
                    pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                    minLength: 36
                    maxLength: 36
            required:
                - contactUserId

        UpdateUsernameRequest:
            type: object
            description: Request payload for updating a user's username
            properties:
                username:
                    type: string
                    minLength: 3
                    maxLength: 16
                    pattern: '^[a-zA-Z0-9_]+$'
                    example: 'Alice'
                    description: New username for the user
            required:
                - username

        Error:
            type: object
            description: Standard error response containing error message
            properties:
                message:
                    type: string
                    example: 'Invalid input provided'
                    description: Error message describing what went wrong
                    pattern: '^.*$'
                    minLength: 1
                    maxLength: 500
            required:
                - message

    responses:
        SuccessMessage:
            description: Operation completed successfully
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            message:
                                type: string
                                example: 'Operation completed successfully'
                                description: Success message indicating the operation was completed
                                pattern: '^.*$'
                                minLength: 1
                                maxLength: 200
                        required:
                            - message

        UnauthorizedError:
            description: Authentication information is missing or invalid
            content:
                application/json:
                    schema:
                        $ref: '#/components/schemas/Error'
                    examples:
                        missing_header:
                            summary: Missing Authorization header
                            value:
                                message: 'Authorization header required'
                        invalid_format:
                            summary: Invalid authorization format
                            value:
                                message: "Invalid authorization format. Use 'Bearer <token>'"
                        invalid_token:
                            summary: Invalid token format
                            value:
                                message: 'Invalid token format'
                        user_not_found:
                            summary: User not found
                            value:
                                message: 'Invalid token - user not found'

paths:
    /:
        get:
            tags: ['Health']
            summary: API root endpoint
            description: Returns basic API information and status
            operationId: getApiRoot
            responses:
                '200':
                    description: API information
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    name:
                                        type: string
                                        example: 'WASAText API'
                                        description: Name of the API service
                                        minLength: 3
                                        maxLength: 50
                                    version:
                                        type: string
                                        example: '1.2.0'
                                        description: Current API version
                                        minLength: 1
                                        maxLength: 10
                                    status:
                                        type: string
                                        example: 'running'
                                        description: Current API status
                                        minLength: 3
                                        maxLength: 20
                                    endpoints:
                                        type: integer
                                        example: 22
                                        description: Number of available API endpoints
                                required:
                                    - name
                                    - version
                                    - status
                                    - endpoints

    /session:
        post:
            tags: ['Authentication']
            summary: User login
            description: |-
                If the user does not exist, it will be created and an
                identifier is returned.
                If the user exists, the user identifier is returned.
            operationId: doLogin
            requestBody:
                description: User login details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/LoginRequest'
                required: true
            responses:
                '201':
                    description: User login successful
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/LoginResponse'
                '400':
                    description: Invalid input - name must be 3-16 characters
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users:
        get:
            tags: ['Users']
            summary: List all users
            description: Returns a list of all users in the system
            operationId: listUsers
            responses:
                '200':
                    description: List of users
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/User'
                                minItems: 0
                                maxItems: 10000
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '500':
                    description: Internal server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
                  minLength: 36
                  maxLength: 36
        put:
            tags: ['Users']
            summary: Update username
            description: Set or update the user's username
            operationId: setMyUserName
            requestBody:
                description: New username for the user
                content:
                    application/json:
                        schema:
                            type: string
                            description: New username for the user
                            pattern: '^[a-zA-Z0-9_]+$'
                            minLength: 3
                            maxLength: 16
                required: true
            responses:
                '200':
                    description: Updated user
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '400':
                    description: Invalid username format
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '401':
                    $ref: '#/components/responses/UnauthorizedError'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/photo:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
                  minLength: 36
                  maxLength: 36
        put:
            tags: ['Users']
            summary: Update user photo
            description: Set or update the user's profile picture
            operationId: setMyPhoto
            requestBody:
                description: New photo URL as a JSON string
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'https://example.com/new-avatar.jpg'
                            description: URL of the new profile picture
                            pattern: '^https?://.*'
                            minLength: 10
                            maxLength: 2048
                required: true
            responses:
                '200':
                    description: Updated user
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/User'
                '400':
                    description: Invalid photo URL
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/context:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
                  minLength: 36
                  maxLength: 36
        get:
            tags: ['Users']
            summary: Get user context
            description: Get context information for the user
            operationId: getContextReply
            responses:
                '200':
                    description: User context retrieved successfully
                    content:
                        text/plain:
                            schema:
                                type: string
                                minLength: 0
                                maxLength: 10000
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  format: uuid
                  minLength: 36
                  maxLength: 36
        get:
            tags: ['Conversations']
            summary: Get user conversations
            description: Returns all conversations for the specified user
            operationId: getMyConversations
            responses:
                '200':
                    description: List of user conversations
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Conversation'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Conversations']
            summary: Create conversation
            description: >-
                Create a new conversation with specified participants
            operationId: createConversation
            requestBody:
                description: Conversation creation details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CreateConversationRequest'
                required: true
            responses:
                '201':
                    description: Conversation created successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Conversation'
                '400':
                    description: Invalid request data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /users/{id}/conversations/{conversationId}/name:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        put:
            tags: ['Conversations']
            summary: Set group name
            description: Set or update the name of a group conversation
            operationId: setGroupName
            requestBody:
                description: New group name
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'Project Team'
                            description: New name for the group conversation
                            pattern: '^.*$'
                            minLength: 1
                            maxLength: 100
                required: true
            responses:
                '200':
                    description: Group name updated successfully
                '400':
                    description: Invalid group name
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/photo:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  format: uuid
        put:
            tags: ['Conversations']
            summary: Set group photo
            description: Set or update the photo of a group conversation
            operationId: setGroupPhoto
            requestBody:
                description: New group photo URL
                content:
                    application/json:
                        schema:
                            type: string
                            example: 'https://example.com/group-photo.jpg'
                            description: URL of the new group photo
                            pattern: '^https?://.*'
                            minLength: 10
                            maxLength: 2048
                required: true
            responses:
                '200':
                    description: Group photo updated successfully
                '400':
                    description: Invalid photo URL
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        get:
            tags: ['Messages']
            summary: Get messages
            description: Get all messages from a conversation
            operationId: getMessages
            responses:
                '200':
                    description: List of messages
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Message'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Messages']
            summary: Send message
            description: Send a new text message or image to the conversation. Images should be provided as base64-encoded data URLs.
            operationId: sendMessage
            requestBody:
                description: Message content (text and/or image)
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/SendMessageRequest'
                required: true
            responses:
                '201':
                    description: Message sent successfully
                    content:
                        application/json:
                            schema:
                                type: string
                                description: UUID of the created message
                                format: uuid
                                pattern: '^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$'
                                minLength: 36
                                maxLength: 36
                '400':
                    description: Invalid message content
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        delete:
            tags: ['Messages']
            summary: Delete message
            description: Delete a message (only by the sender)
            operationId: deleteMessage
            responses:
                '204':
                    description: Message deleted successfully (no content)
                '401':
                    description: Not authorized to delete this message
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/forward:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        post:
            tags: ['Messages']
            summary: Forward message
            description: Forward a message (including images) to another conversation with a [Forwarded] prefix
            operationId: forwardMessage
            requestBody:
                description: Target conversation for forwarding
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/ForwardMessageRequest'
                required: true
            responses:
                '200':
                    description: Message forwarded successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Conversation'
                '400':
                    description: Invalid request data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message or target conversation not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/comments:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        post:
            tags: ['Comments']
            summary: Toggle comment (emoji)
            description: Toggle an emoji comment on a message. If the user has already commented with this emoji, it will be removed. If not, it will be added.
            operationId: reactToMessage
            requestBody:
                description: Emoji to toggle
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/Comment'
                required: true
            responses:
                '204':
                    description: Comment toggled successfully (no content)
                '400':
                    description: Invalid comment data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: Message not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/conversations/{conversationId}/messages/{messageId}/comments/{emoji}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: conversationId
              in: path
              description: UUID of the conversation
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: messageId
              in: path
              description: UUID of the message
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: emoji
              in: path
              description: The emoji reaction to remove
              required: true
              schema:
                  type: string
                  pattern: '^.{1,10}$'
                  minLength: 1
                  maxLength: 10
        delete:
            tags: ['Comments']
            summary: Remove comment (emoji)
            description: Remove a specific emoji comment from a message
            operationId: removeReaction
            responses:
                '204':
                    description: Comment removed successfully (no content)
                '404':
                    description: Message or emoji comment not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/contacts:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        get:
            tags: ['Contacts']
            summary: List contacts
            description: Get all contacts for the user
            operationId: listContacts
            responses:
                '200':
                    description: List of contacts
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/Contact'
                                minItems: 0
                                maxItems: 1000
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
        post:
            tags: ['Contacts']
            summary: Add contact
            description: Add a new contact for the user
            operationId: addContact
            requestBody:
                description: Contact details
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/AddContactRequest'
                required: true
            responses:
                '201':
                    description: Contact added successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Contact'
                '400':
                    description: Invalid contact data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: User not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /users/{id}/contacts/{contactId}:
        parameters:
            - name: id
              in: path
              description: UUID of the user
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
            - name: contactId
              in: path
              description: UUID of the contact
              required: true
              schema:
                  type: string
                  minLength: 36
                  maxLength: 36
                  format: uuid
        delete:
            tags: ['Contacts']
            summary: Remove contact
            description: Remove a contact from the user's contact list
            operationId: removeContact
            responses:
                '204':
                    description: Contact removed successfully (no content)
                '404':
                    description: Contact not found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /ws:
        get:
            tags: ['WebSocket']
            summary: WebSocket connection
            description: >-
                Establish a WebSocket connection for real-time communication
            operationId: serveWs
            responses:
                '101':
                    description: WebSocket connection established
                '400':
                    description: Bad request - cannot upgrade to WebSocket
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'

    /liveness:
        get:
            tags: ['Health']
            summary: Health check
            description: Health check endpoint for monitoring server status
            operationId: liveness
            responses:
                '200':
                    description: Server is healthy
